# Guards Inventory

| Name | Command | Location | Purpose | Scope / What it scans | Pass / Fail Behavior |
| --- | --- | --- | --- | --- | --- |
| guard:hero | `pnpm -w guard:hero` | `packages/champagne-guards/scripts/guard-hero.mjs` | Protects marketing hero renderer contract and sacred manifests. | Reads `apps/web/app/_components/HeroRenderer/HeroRenderer.tsx` and `packages/champagne-manifests/data/hero/sacred_*` JSON for required imports/keys. | Logs success when renderer/manifests align; fails if required imports, exports, or manifest keys are missing. |
| guard:canon | `pnpm -w guard:canon` | `packages/champagne-guards/scripts/guard-canon.mjs` | Prevents canon drift for gradients/tokens. | Confirms `gradients.gradient.base` in `packages/champagne-manifests/data/hero/sacred_hero_surfaces.json` uses `var(--smh-gradient)`, verifies canonical `--smh-gradient` and brand token values inside `packages/champagne-tokens/styles/tokens/smh-champagne-tokens.css`, and blocks token-file diffs. | Warns when allowlisted canon files changed; fails on missing files, gradient mismatches, unauthorized hex, or token edits. |
| guard:rogue-hex | `pnpm -w guard:rogue-hex` | `packages/champagne-guards/scripts/guard-rogue-hex.mjs` | Repo-wide rogue colour scan. | Traverses git-tracked files under `apps/**`, `packages/**`, and `public/**` (excluding allowlisted assets/tests) for `#RRGGBB`, `#RGB`, `#RRGGBBAA`, `rgb(`, or `hsl(` tokens. | Prints warnings for allowlisted file edits; fails with file:line for any disallowed literal. |
| guard:hero-freeze | `pnpm --filter @champagne/guards guard:hero-freeze` | `packages/champagne-guards/scripts/guard-hero-freeze.mjs` | Ensures sacred hero media stays frozen. | Hashes hero media against `hero-freeze.hashes.json` (derives some assets via `hash-media.mjs`). | Fails when expected files are missing or hashes diverge from the baseline. |
| guard:manifest / guard:manifests | `pnpm --filter @champagne/guards guard:manifest` | `packages/champagne-guards/scripts/guard-manifest-sync.mjs` | Confirms brand/Champagne manifests reference real public assets. | Validates paths in `styles/champagne/manifest.json` and `public/brand/manifest.json` exist in `public/`. | Fails with missing asset list; otherwise prints synced status. |
| guard:brand-structure | `pnpm --filter @champagne/guards guard:brand-structure` | `packages/champagne-guards/scripts/brand-structure-guard.cjs` | Checks brand folder structure stays in canon layout. | Scans brand directories against expected structure and manifest references. | Exits non-zero on missing/misplaced brand assets. |
| guard-asset-size | `node packages/champagne-guards/scripts/guard-asset-size.mjs` | `packages/champagne-guards/scripts/guard-asset-size.mjs` | Prevents oversized public assets. | Looks at added/modified files in `public/` since base commit and enforces size threshold (`PUBLIC_MAX_MB`, default 6MB). | Fails when a changed asset exceeds the size limit. |
| guard-sacred-routes | `node packages/champagne-guards/scripts/guard-sacred-routes.mjs` | `packages/champagne-guards/scripts/guard-sacred-routes.mjs` | Protects sacred routes from edits. | Diff-scans route files listed inside the script to ensure they were not altered. | Fails if sacred route content changes. |
| guard-preview-only | `node packages/champagne-guards/scripts/guard-preview-only.mjs` | `packages/champagne-guards/scripts/guard-preview-only.mjs` | Blocks preview-only routes from shipping live. | Checks that preview-only pages remain within preview folders and that live routes are untouched. | Fails on detected preview-to-live drift. |
| brand-guard / brand-lock-guard / brand-guard.smoke | `node packages/champagne-guards/scripts/brand-guard.cjs` (and related) | `packages/champagne-guards/scripts/brand-guard.cjs` etc. | Token/gradient lock utilities used to enforce brand palette and gradients. | Parse token CSS (including `--smh-gradient`) and compare against expected values or lock files. | Fail when canonical gradient/tokens diverge; smoke variant builds temporary token sheet for sanity checks. |
| verify-hue | `node packages/champagne-guards/scripts/verify-hue.cjs` | `packages/champagne-guards/scripts/verify-hue.cjs` | Hue verification helper for gradients. | Parses gradients for expected hue range. | Fails when hue ranges fall outside expected thresholds. |
| lock-gradient | `node packages/champagne-guards/scripts/lock-gradient.cjs` | `packages/champagne-guards/scripts/lock-gradient.cjs` | Regenerates locked gradient tokens. | Rewrites token files to a locked gradient value. | Fails when locking cannot locate `--smh-gradient`. |

## Legacy guard copies

The `_champagne-extraction/guards-and-scripts/scripts/` directory contains historical mirrors of several guards used for audits and extraction work:

- `guard-asset-size.mjs`, `guard-manifest-sync.mjs`, `guard-sacred-routes.mjs`, `guard-rogue-hex.mjs`, `guard-hero-freeze.mjs`, and `guard-preview-only.mjs` (functionally similar to the current guard scripts).
- Brand/token utilities such as `brand-guard.cjs`, `brand-guard.smoke.mjs`, `brand-lock-guard.cjs`, `lock-gradient.cjs`, and `verify-brand-tokens.ts` for offline audits.

These copies are not wired into current CI but remain available for reference and manual validation.
